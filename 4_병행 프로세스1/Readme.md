**학습개요**

**1. 최근에는 여러 프로세스가 단순히 순차처리가 아닌 병행처리될 필요가 많습니다. 음악 파일을 배경음악으로 재생하며 동영상도 틀어 놓고 문서작업을 하는 경우, 운영체제는 이들을 병행으로 처리해야 합니다. 특히 이렇게 병행처리되는 프로세스가 서로 유기적으로 상호작용하며 동작하는 경우에는 해결해야 할 다양한 문제가 존재합니다. 이번 강의에서는 병행 프로세스의 기본 개념과 함께 상호배제와 동기화 문제를 알아봅니다. 그리고 이를 해결하기 위해 제공되는 장치들에 대해 학습합니다.**

**학습목표**

1. **병행성과 병행 프로세스의 개념을 설명할 수 있다.**
2. **병행성 문제를 설명할 수 있다.**
3. **세마포어의 개념을 설명할 수 있다.**

## 병행 프로세스의 개요

### 병행성과 병행 프로세스

병행성(concurrency)

- 여러 개의 프로세스 또는 쓰레드가 동시 수행되는 시스템의 특성

병행 프로세스

- 동시 수행되는 여러 개의 프로세스 또는 쓰레드

### 병행 프로세스의 실행 형태

1개의 CPU : **인터리빙** 형식

3의 프로세스 , 1개의 CPU 일때 CPU의 입장에서는 한 순간에는 한 개의 프로세스만 수행할 수있다. 번갈아 가면서 처리하기 때문에 병행프로세스로 존재 할 수 있다.

여러 개의 CPU : **병렬처리 형식**

3개의 프로세스, 3의 CPU 일떄, 한 시점에 세 개의 프로세스가 동시에 병렬처리가 가능하다.

멀티프로세서 시스템에서의 메모리에 따라

- 강결합 시스템(공유 메모리 구조) - 여러 CPU 들이 1개의 메모리를 공유해서 쓴다. ( 분배하거나 시간대를 나눠 쓴다.)
- 약결합 시스템(분산 메모리 구조) - CPU 마다 메모리를 가지고 있다. CPU 끼리 정보를 주고받으려면 네트워크 통신을 해야 한다.

### 프로세스 간의 관계

독립 프로세스

- 수행 중인 다른 프로세스에 영향을 주지도 받지도 않음
- 데이터 및 상태를 다른 프로세스와 공유하지 않음
- 프로세스의 실행
  - 결정적 : 실행 결과는 **입력에 의해서만** 결정됨
  - 재생 가능 : 같은 입력에 대해 항상 동일한 실행 결과

협력 프로세스

- 수행 중인 다른 프로세스와 영향을 주고받음
- 데이터 및 상태를 다른 프로세스와 공유
- 프로세스의 실행
  - 비결정적 : 실행결과는 실행순서에 좌우됨
  - 재생 불가능 : 같은 입력에 대해 항상 동일한 실행결과를 보장하지 못함(실행중 다른 프로세스와의 관계가 틀어지면 결과가 달라질 수 있기 때문)

## 병행성 문제

협력 프로세스인 경우 발생 가능한 문제

상호배제

- 2개 이상의 프로세스가 동시에 임계영역을 수행하지 못하도록 하는 것
- 임계영역 : 2개 이상의 프로세스가 **동시에 사용하면 안 되는** 공유자원을 액세스 하는 프로그램 코드 영역
  - 2개의 프로세스가 같이 사용할 수 있는 공유자원(ex. 잔고 10,000원)이 있을 때
  - A프로세스가 공유자원의 잔고를 확인하고 입금을 한 후 **업데이트 하기 전에**, B프로세스도 공유자원의 잔고를 확인 하고 입금을 하게 되면, A프로세스의 입금 후의 잔고가 아닌 처음의 잔고에서 B프로세스의 입금이 업데이트 되어 버린다. → 상호 배제가 잘못됨
  - A프로세스 가 진행될때는, B프로세스는 임계영역을 수행하지 않고 기다림, A프로세스가 끝나고 나면 B프로세스 진행

동기화

2개 이상의 프로세스에 대한 **처리순서를 결정하는 것**

프로세스 동기화

서로 다른 프로세스지만 둘 사이의 순서관계를 정해주어야 한다

- 계좌1의 잔고의 일부금액을 인출(출금프로세스A)해서 계좌2의 잔고에 입금(입금프로세스A) 해야한다
- 동기화가 잘못되면?? 출금되기 전에 입금이 먼저 되면?? 총 잔고가 잘못되어 버린다

상호배제 : 임계영역에 대한 동기화 문제

통신

프로세스들이 데이터를 공유하기 위해 반드시 필요

- 프로세스 간 통신(IPC)

통신 방법

- 하나의 변수 사용
- 메시지를 서로 주고 받음

## 세마포어

상호배제와 동기화 문제를 해결하기 위한 도구

Dijkstra가 제안

정수형 **공용변수**

- 저장값 : 사용 가능한 자원의 수 또는 또는 잠김이나 풀림의 상태

상황에 맞춰 0 이상인 정수로 초기화

두 기본연산 P와 V에 의해서만 사용됨

- 기본연산 : 인터럽트되지 않고 하나의 단위로 처리됨
- 연산 P
  - 검사, 감소 시키려는 시도

    ```java
    void P(semaphore s){
    	if(s > 0)
    		s--;
    	else
    		현재 프로세스를 대기시킴;
    }
    ```

- 연산 V
  - 증가

    ```java
    void V(semaphore s){
    	if( 대기 중인 프로세스 없음)
    		s++;
    	else
    		대기 중인 프로세스 1개 진행;
    }
    ```


세마포어마다 대기 큐 필요

### 상호배제 해결

상호배제를 위한 일반적인 요구사항

- 한 프로세스가 임계영역 수행 중
  - 다른 프로세스는 임계영역에 진입해서는 안 됨
- 임계영역 수행 중이던 프로세스가 임계영역 벗어남
  - 누군가 하나는 임계영역을 새로이 수행할 수 있어야 함
- 임계영역 진입 못하고 대기하는 프로세스
  - 적절한 시간 내에 임계영역 수행을 시작할 수 있어야 함

상호 배제를 위한 임계영역 주변의 코드 영역

```java
...
진입영역
------
임계영역
------
해제영역
...
```

- 임계영역에 대한 수행을 해도 되는지 체크
- 다른 프로세스가 임계영역 수행을 시작할 수 있도록 함

세마 포어 이용

```java
...
P(mutex);
--------
임계영역
--------
V(mutex);
...
```

세마 포어 mutex 초깃값은 1

진입영역 : P

해제 영역 : V

대기 큐는 FIFO 로 동작

### 동기화 해결

상황 : 프로세스 A가 코드s1 을 수행한 후 프로세스B가 코드 s2를 수행하도록 동기화

s1이 수행된 후 V(sync)연산, s2가 수행되기 전에 P(sync)연산

세마포어 sync 초깃값은 0

---

**정리하기**

1. **병행성은 여러 개의 프로세스 또는 쓰레드가 동시에 수행되는 시스템의 특성을 의미하고, 동시에 수행되는 여러 개의 프로세스 또는 쓰레드를 병행 프로세스라고 한다.**
2. **병행 프로세스는 프로세스 간의 관계에 따라 독립 프로세스 또는 협력 프로세스이다.**
3. **협력 프로세스는 병행성과 관련하여 상호배제, 동기화, 통신과 관련한 다양한 문제가 발생할 수 있다.**
4.  **임계영역은 2개 이상의 프로세스가 동시에 사용하면 안 되는 공유자원을 액세스하는 프로그램 코드 영역을 의미한다.**
5. **상호배제는 2개 이상의 프로세스가 동시에 임계영역을 수행하지 못하도록 하는 것이다.**
6. **동기화는 2개 이상의 프로세스에 대한 처리순서를 결정하는 것이다.**
7. **세마포어는 상호배제와 동기화 문제를 해결하기 위한 정수형 공용변수로, 2개의 기본연산 P와 V에 의해서만 사용될 수 있다.**
